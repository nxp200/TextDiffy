!function(){"use strict";const e={whitespaceSensitive:!0,caseSensitive:!0,granularity:"line"},t=e=>document.querySelector(e);function n(t,n){let r=t;return n.whitespaceSensitive||(r=r.replace(/\s+/g," ").trim()),n.caseSensitive||(r=r.toLowerCase()),r}function r(e){return e.replace(/\r\n?/g,"\n").split("\n")}function a(){return new Promise((e=>setTimeout(e,0)))}function i(e){try{const t=e.match(/[\p{L}\p{N}_]+|\s+|[^\s\p{L}\p{N}_]/gu);return t??[e]}catch(t){const n=e.match(/[A-Za-z0-9_]+|\s+|[^\sA-Za-z0-9_]/g);return n??[e]}}function s(e){return Array.from(e)}function o(e,t,n=((e,t)=>e===t)){const r=[];function a(a,i,s,l){for(;a<i&&s<l&&n(e[a],t[s]);)r.push({op:"equal",a:e[a],b:t[s]}),a++,s++;for(;a<i&&s<l&&n(e[i-1],t[l-1]);)i--,l--,r.push({op:"equal-suf",a:e[i],b:t[l]});if(a===i){for(let e=s;e<l;e++)r.push({op:"insert",b:t[e]});return}if(s===l){for(let t=a;t<i;t++)r.push({op:"delete",a:e[t]});return}const c=new Map,u=new Map;for(let t=a;t<i;t++)c.set(e[t],(c.get(e[t])||0)+1);for(let e=s;e<l;e++)u.set(t[e],(u.get(t[e])||0)+1);const d=new Map;for(let e=s;e<l;e++){const n=t[e];1===u.get(n)&&d.set(n,e)}const f=[];for(let t=a;t<i;t++){const n=e[t];1===c.get(n)&&d.has(n)&&f.push([t,d.get(n)])}const p=[],h=new Array(f.length).fill(-1),m=new Array(f.length).fill(-1);for(let e=0;e<f.length;e++){const t=f[e][1];let n=0,r=p.length;for(;n<r;){const e=n+r>>1;p[e][1]<t?n=e+1:r=e}n>0&&(h[e]=m[n-1]),p[n]=f[e],m[n]=e}const y=[];let g=m[p.length-1];for(;g>=0;)y.push(f[g]),g=h[g];if(y.reverse(),0===y.length){for(let t=a;t<i;t++)r.push({op:"delete",a:e[t]});for(let e=s;e<l;e++)r.push({op:"insert",b:t[e]});return}let v=a,b=s;for(const[e,t]of y)v<e||b<t&&a(v,e,b,t),r.push({op:"equal",a:e[e],b:t[t]}),v=e+1,b=t+1;(v<i||b<l)&&a(v,i,b,l)}a(0,e.length,0,t.length);const i=[],s=[];for(const e of r)"equal-suf"===e.op?s.push({op:"equal",a:e.a,b:e.b}):i.push(e);return i.concat(s)}function l(e){const t=[];for(let n=0;n<e.length;n++){const r=e[n];if("delete"===r.op&&n+1<e.length&&"insert"===e[n+1].op){t.push({op:"modify",old:r.a,new:e[n+1].b}),n++;continue}"equal"===r.op?t.push(r):"insert"===r.op?t.push({op:"insert",b:r.b}):"delete"===r.op&&t.push({op:"delete",a:r.a})}return t}function c(e,t,n){if("line"===n)return null;const r="word"===n?i(e):s(e),a="word"===n?i(t):s(t),u=o(r,a,((e,t)=>e===t)),d=[];for(const e of u)"equal"===e.op?d.push({type:"same",text:e.a}):"insert"===e.op?d.push({type:"add",text:e.b}):"delete"===e.op&&d.push({type:"remove",text:e.a});return d}async function u(t,i,s=e){const u=r(t),d=r(i),f=u.map((t=>n(t,s))),p=d.map((t=>n(t,s))),h=o(f,p,((e,t)=>e===t)),m=l(h),y=[];let g=0,v=0;for(const e of m){if("equal"===e.op)y.push({type:"same",line:u[g]}),g++,v++;else if("insert"===e.op)y.push({type:"add",line:d[v]}),v++;else if("delete"===e.op)y.push({type:"remove",line:u[g]}),g++;else if("modify"===e.op){const e=u[g],t=d[v],n=c(e,t,s.granularity);y.push({type:"modify",old:e,new:t,parts:n}),g++,v++}(g+v)%2e3==0&&await a()}return y}function d(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function f(e){const t=document.createElement("span");return t.className="add"===e.type?"token-add":"remove"===e.type?"token-remove":"token-same",t.textContent=e.text,t}function p(e){const n=t("#diffOutput");d(n);const r=document.createDocumentFragment();for(const t of e){const e=document.createElement("div");e.className=`diff-line ${t.type}`;const n=document.createElement("span");n.className="prefix";const a=document.createElement("div");if(a.className="modify"===t.type?"inline-lines":"inline-line","same"===t.type)n.textContent=" ",a.appendChild(Object.assign(document.createElement("div"),{className:"inline-line",textContent:t.line}));else if("add"===t.type)n.textContent="+",a.appendChild(Object.assign(document.createElement("div"),{className:"inline-line",textContent:t.line}));else if("remove"===t.type)n.textContent="âˆ’",a.appendChild(Object.assign(document.createElement("div"),{className:"inline-line",textContent:t.line}));else if("modify"===t.type){n.textContent="~";const e=document.createElement("div");e.className="inline-line",e.setAttribute("aria-label","Modified old line");const r=document.createElement("div");if(r.className="inline-line",r.setAttribute("aria-label","Modified new line"),t.parts&&Array.isArray(t.parts))for(const n of t.parts)("same"===n.type||"remove"===n.type)&&e.appendChild(f({type:"same"===n.type?"same":"remove",text:"add"===n.type?"":n.text})),("same"===n.type||"add"===n.type)&&r.appendChild(f({type:"same"===n.type?"same":"add",text:"remove"===n.type?"":n.text}));else e.textContent=t.old,r.textContent=t.new;a.appendChild(e),a.appendChild(r)}e.appendChild(n),e.appendChild(a),r.appendChild(e)}n.appendChild(r)}function h(e){let t=0,n=0,r=0;for(const a of e)"add"===a.type?t++:"remove"===a.type?n++:"modify"===a.type&&r++;const i=document.getElementById("total-added"),s=document.getElementById("total-removed"),o=document.getElementById("total-modified");i&&(i.textContent=String(t)),s&&(s.textContent=String(n)),o&&(o.textContent=String(r))}function m(e){const t=[];for(const n of e)"same"===n.type?t.push("  "+n.line):"add"===n.type?t.push("+ "+n.line):"remove"===n.type?t.push("- "+n.line):"modify"===n.type&&(t.push("- "+n.old),t.push("+ "+n.new),n.parts&&t.push("~ "+n.parts.map((e=>"add"===e.type?"{+"+e.text+"+}":"remove"===e.type?"{-"+e.text+"-}":e.text)).join("")));return t.join("\n")}async function y(e){try{if(navigator.clipboard&&navigator.clipboard.writeText)return await navigator.clipboard.writeText(e),!0}catch(e){}const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select();try{return document.execCommand("copy"),!0}catch(e){return!1}finally{document.body.removeChild(t)}}function g(e,t){const n=new Blob([t],{type:"text/plain;charset=utf-8"}),r=URL.createObjectURL(n),a=document.createElement("a");a.href=r,a.download=e,document.body.appendChild(a),a.click(),setTimeout((()=>{URL.revokeObjectURL(r),document.body.removeChild(a)}),0)}async function v(){const n=t("#inputA").value,r=t("#inputB").value,i={...e.AppState},s=performance.now(),o=await u(n,r,i);return p(o),h(o),performance.now()-s>200&&await a(),o}function b(){const n=t("#whitespaceSensitive"),r=t("#caseSensitive"),a=t("#granularity");n&&n.addEventListener("change",(()=>{e.whitespaceSensitive=n.checked})),r&&r.addEventListener("change",(()=>{e.caseSensitive=r.checked})),a&&a.addEventListener("change",(()=>{e.granularity=a.value}));const i=t("#compareBtn"),s=t("#copyBtn"),o=t("#exportBtn");i&&i.addEventListener("click",(async()=>{await v()})),s&&s.addEventListener("click",(async()=>{const e=await v(),t=m(e);(await y(t))||alert("Copy failed: your browser may not support clipboard APIs.")})),o&&o.addEventListener("click",(async()=>{const e=await v(),t=m(e);g("textdiffy-diff.txt",t)}))}document.addEventListener("DOMContentLoaded",b),window.TextDiffy={AppState:e,buildStructuredDiff:u,renderDiff:p,updateMetrics:h,serializePlain:m,runCompare:v,__internals:{splitLines:r,normalizeLine:n,tokenizeWords:i,tokenizeChars:s,patienceDiff:o,granularLineDiff:c,yieldToUI:a}}}();
